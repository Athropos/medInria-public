#!/bin/bash

# Usage: 
# - mac_packager.sh plugin1 plugin2 ... pluginN
# or
# - mac_packager.sh path_to_plugins/*

# To build a stand-alone mac version of medinria, do the following:

# 1. build medinria
# 2. build medinria-plugins as well as your desired own plugins
# 2. make install of each project
# 3. chmod u+x mac_pacakger.sh
# 4. run mac_pacakger.sh with each argument being a script to package your plugins, e.g. : ./mac_packager.sh ${Plugins_Build_Dir}/mac_visages_plugins_packager.sh

# The bundle medinria.app will contain all plugins and will be standalone, packaged into MedINRIA.dmg in the install dir

cd @CMAKE_INSTALL_PREFIX@/bin/
@QT_BINARY_DIR@/macdeployqt medinria.app

#Run sub-packagers
for i in $*; do
	resultRootDir=`/bin/bash $i`
	echo Copying plugins from $resultRootDir
	
	\cp -r $resultRootDir/Applications/medinria.app/Contents/Frameworks @CMAKE_INSTALL_PREFIX@/bin/medinria.app/Contents/
	\cp -r $resultRootDir/Applications/medinria.app/Contents/PlugIns @CMAKE_INSTALL_PREFIX@/bin/medinria.app/Contents/
done

#Run fancy packaging apple script
osascript @PROJECT_BINARY_DIR@/ScriptGenerateMedInriaFancyDMG.scpt
